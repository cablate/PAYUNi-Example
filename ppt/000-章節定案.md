要做的不是「教寫程式」，而是**「傳授一套經得起商業考驗的系統架構，並附帶一個能直接變現的懶人包」**。

我們的節奏必須是：
1.  **先給甜頭 (Bo-Jun)**：快速部署看到成果。
2.  **再解焦慮 (Billy)**：拆解黑盒子，畫出架構圖與資料庫欄位。
3.  **最後給武器 (Both)**：如何看文件避坑、如何指揮 AI、如何延伸應用。

---

### 🗺️ 課程架構總表 (The Final Map)

| 階段 | 章節 | 核心主題 | 對應 Persona 狀態 |
| :--- | :--- | :--- | :--- |
| **啟動** | **Ch 0 & 1** | **(已完成) 部署與全貌** | 拿到 Code，會動了，爽感建立。 |
| **可視化** | **Ch 2** | **流程具象化 (Flow)** | 看懂圖，知道資料怎麼跑（Happy Path）。 |
| **驗證** | **Ch 3** | **官方文件導讀 (Docs)** | 看懂文件，知道圖對應到官方哪裡。 |
| **防禦** | **Ch 4** | **威脅建模 (Security)** | 知道哪裡有洞，為什麼要加密。 |
| **指揮** | **Ch 5** | **規格與指令 (The Spec)** | **(重設計)** 不看 Code，改教「設計資料庫」與「下 Prompt」。 |
| **運營** | **Ch 6** | **延伸應用 (Biz Logic)** | 退款、會員、資料變現。 |

---

### 📂 詳細章節拆分與設計思路

#### **Ch 0：前言 - 為什麼 AI 時代你更需要懂金流架構？**
> **目標：** 定調課程。這不是語法課，這是「指揮官」培訓課。

*   **0-1 痛點共鳴：** 開發很快，串金流很卡？(Billy 的焦慮) vs 想幫客戶做網站卻卡在收錢？(Bo-Jun 的場景)。
*   **0-2 課程定位：** 我們不手刻每一行 Code，我們學會「設計規格」讓 AI 幫我們寫。
*   **0-3 交付物預覽：** 展示「全能程式碼包 (Starter Kit)」——含金流、會員、Google Sheets DB、資安防護。

#### **Ch 1：極速啟動 - 5 分鐘讓你的收銀機響起來 (The Quick Win)**
> **目標 (Bo-Jun Hotspot 🔥)：** 讓他拿到「懶人包」，證明這東西能動。

*   **1-1 準備軍火庫 (Starter Kit)：** 下載原始碼，簡單介紹檔案結構（這是前端頁、這是後端 API）。
*   **1-2 取得通行證 (API Key)：** 帶領申請 PAYUNi Sandbox（強調：免審核、免統編，馬上就能用）。
*   **1-3 點火升空 (Deploy)：** 設定 `.env`，一鍵部署到 Zeabur/Vercel。
*   **1-4 第一筆交易：** 實際刷一筆測試單，看綠燈亮起，信箱收到通知。
    *   *Bo-Jun OS：太讚了，這包 Code 是好的，值回票價。*


#### **Chapter 2：解構黑盒子 — 流程可視化**
> **目標：** 把 2-1 的腦內模擬畫成圖，不講程式碼，只講資料流向。

*   **2-1 (已錄完)：架構師的腦內模擬** (總綱)。
*   **2-2 戰術地圖：一次性支付 (Standard Flow)**
    *   **重點：** Hosted Page 模式的標準流程。
    *   **核心：** 去程 (帶參數) -> 金流頁 -> 回程 (Webhook)。
*   **2-3 進階地圖：訂閱制的父子單邏輯 (Parent-Child Orders)**
    *   **重點：** 聚焦 PAYUNi 的「定期定額」機制。
    *   **核心概念：**
        *   **父單 (Parent Order)：** 第一次刷卡，建立授權，User 在線。
        *   **子單 (Child Order)：** 每月自動產生，User 不在線，金流商直接呼叫 Server。
    *   **關鍵差異：** 子單沒有「前端轉址」，只有 Webhook 通知，這也是為什麼後端這麼重要。
*   **2-4 資料解密：Redirect vs Webhook**
    *   **重點：** 比較兩個 JSON Payload 的差異。
    *   **核心：** 雖然都能導回網站，但 Payload 內容含金量不同（Webhook 才有完整交易細節）。

#### **Chapter 3：透視文件 — 把雜訊過濾掉 (原本的 Ch 5)**
> **目標：** 剛懂了流程，現在教你怎麼在充滿雜訊的官方文件中找到對應的欄位。

*   **3-1 文件迷宮導航：**
    *   打開 PAYUNi API 文件，告訴學員 80% 都不用看，我們只關注「建立訂單」與「幕後通知」。
*   **3-2 術語對照表 (The Mapping)：**
    *   把 Ch 2 的圖拿出來，跟文件對答案。
    *   圖上的「回程通知」 = 文件裡的 `NotifyURL`。
    *   圖上的「父子單」 = 文件裡的 `PeriodID` (委託單號)。
*   **3-3 隱藏的陷阱 (The Mega)：**
    *   文件沒寫清楚的坑：例如金額限制、測試環境的特殊參數。

#### **Chapter 4：威脅建模 — 駭客視角 (原本的 Ch 3)**
> **目標：** 在進入規格設計前，先建立「防禦意識」。

*   **4-1 中間人攻擊 (MITM)：**
    *   為什麼需要 `CheckMacValue`？演示把金額從 1000 改成 1 的風險。
*   **4-2 偽造通知 (Fake Webhook)：**
    *   如果駭客直接打你的 API 說「付錢了」怎麼辦？教 IP 驗證與驗簽觀念。
*   **4-3 狀態機的必要性 (State Machine)：**
    *   為什麼不能只存 `Paid: True/False`？
    *   介紹 `Created` -> `Paid` -> `Failed` 的流轉，防止重複發貨。

#### **Chapter 5：指揮官視角 — 從資料庫設計到 AI 指令 (重磅重製 🔥)**
> **目標：** 取代原本的 Code Review。不教怎麼寫 Code，教怎麼**「設計」**並讓 AI 寫。

*   **5-1 💾 資料庫設計：為「父子單」打造容器**
    *   **核心教學：** 既然 Ch 2-3 講了父子單，我們的 DB 要怎麼存？
    *   **Schema 設計：**
        *   `Orders Table` (訂單表)：存金額、狀態、使用者。
        *   `Subscriptions Table` (訂閱表)：存 `PeriodID` (父單號)、`NextPaymentDate` (下次扣款日)。
        *   **關鍵點：** 教學員如何用關聯 (Relation) 把這兩張表連起來。
*   **5-2 📝 規格轉譯：寫出完美的 Prompt**
    *   **核心教學：** 把 Ch 2 的流程 + Ch 4 的資安 + Ch 5-1 的 DB，組合成一段給 AI 的指令。
    *   **實戰演示：**
        *   ❌ 爛 Prompt：「幫我寫一個金流串接。」
        *   ✅ 好 Prompt：「我要串接 PAYUNi，請幫我設計一個後端 API，需包含 `CheckMacValue` 驗簽邏輯，並在收到 Webhook 時，根據 `PeriodID` 判斷是首購還是續扣，寫入我設計好的 Supabase/Sheets 資料庫。」
*   **5-3 驗收你的 AI 員工**
    *   **核心教學：** 當 AI 給你 Code 之後，你怎麼知道是對的？
    *   **Checklist：** 有沒有做驗簽？有沒有處理 DB 寫入失敗？Key 有沒有寫在 `.env`？

#### **Chapter 6：延伸與運營 (原本的 Ch 7)**
> **目標：** 產品上線後的真實場景。

*   **6-1 退款與取消的藝術 (Refunds & Cancel)：**
    *   **實務建議：** 訂閱制最怕「取消訂閱」找不到按鈕。教如何在 DB 標記 `Active: False` 來暫停扣款（或是手動去後台停用）。
    *   **退款策略：** 真的需要串退款 API 嗎？初期「人工退款」的 SOP 其實更省成本。
*   **6-2 會員系統的整合 (Member System)：**
    *   如何把金流的 `Email` 跟 Google Login 的 `User` 綁定？(透過 Email 或 UserID 關聯)。
*   **6-3 數據的價值：**
    *   訂單資料能做什麼？(計算 LTV、預測下個月收入)。

---

### 💡 架構師點評：為什麼這樣改更好？

1.  **Ch 2-3 講「父子單」**：這直接命中台灣金流的實作核心，比講國外的 Token 更有實戰價值，這會讓學員覺得「你真的懂」。
2.  **文件 (Ch 3) 緊接流程 (Ch 2)**：這解決了「學了理論但看不懂說明書」的斷層。
3.  **刪除 Code Review，改為 Prompt Engineering (Ch 5)**：這是一個巨大的升級。這讓課程從「程式課」變成了「AI 產品經理課」。
    *   你不再需要逐行解釋 `if (checkMacValue != ...)`。
    *   你轉而教他們：「你要叫 AI 記得寫驗證邏輯」。這更輕鬆，也更符合 AI 時代的需求。
4.  **Ch 6 的實用性**：保留了「怎麼活下去」的運營智慧，這是純技術課程學不到的。