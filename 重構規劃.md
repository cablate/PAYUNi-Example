# ğŸ”§ é‡‘æµä¸²æ¥ç³»çµ± - å®Œæ•´é‡æ§‹è¦åŠƒæŒ‡å—

> ğŸ“… å»ºç«‹æ—¥æœŸï¼š2025-12-01
> ğŸ‘¥ ç›®æ¨™å°è±¡ï¼šJunior é–‹ç™¼è€…
> ğŸ¯ ç›®æ¨™ï¼šæ•´ç†ç¨‹å¼ç¢¼ã€æå‡å¯ç¶­è­·æ€§ã€å®Œæ•´ä¸­æ–‡åŒ–

---

## ğŸ“Š å°ˆæ¡ˆç¾æ³åˆ†æ

### âœ… å„ªé»
- æ¸…æ™°çš„æ¨¡çµ„åŒ–çµæ§‹ï¼ˆroutesã€servicesã€middlewareã€utilsï¼‰
- è‰¯å¥½çš„å®‰å…¨æ€§é…ç½®ï¼ˆCSRFã€Rate Limitã€Helmetï¼‰
- å®Œæ•´çš„è¨‚é–±åˆ¶å’Œä¸€æ¬¡æ€§ä»˜æ¬¾æ”¯æ´
- Google Sheets ä½œç‚ºè³‡æ–™åº«çš„å‰µæ–°è§£æ±ºæ–¹æ¡ˆ
- åŠŸèƒ½æ¸¬è©¦éƒ½æ­£å¸¸é‹ä½œ

### âš ï¸ éœ€æ”¹é€²é …ç›®
- å‰ç«¯ JavaScript ç¼ºä¹æ¨¡çµ„åŒ–ï¼ˆapp.js 400+ è¡Œï¼‰
- éƒ¨åˆ†æ¥­å‹™é‚è¼¯é‡è¤‡
- æ–‡æª”éå¤šä¸”åˆ†æ•£
- ç¼ºå°‘ JSDoc è¨»é‡‹
- éŒ¯èª¤è™•ç†ä¸ä¸€è‡´
- **è‹±æ–‡èˆ‡ä¸­æ–‡æ··ç”¨ï¼Œä¸å¤ å‹å¥½**

---

## ğŸ¯ é‡æ§‹ç›®æ¨™

1. **æ–‡æª”ç²¾ç°¡**ï¼šåªä¿ç•™ 1-2 ä»½é—œéµç´¢å¼•æ–‡ä»¶
2. **ç¨‹å¼ç¢¼æ¨¡çµ„åŒ–**ï¼šæ‹†åˆ†å‰ç«¯ JavaScriptï¼Œæå‡å¯ç¶­è­·æ€§
3. **ä¸­æ–‡åŒ–**ï¼šå…¨é¢ç¹é«”ä¸­æ–‡å‹å¥½åŒ–
4. **ç¨‹å¼ç¢¼å“è³ª**ï¼šçµ±ä¸€å‘½åã€æ–°å¢è¨»é‡‹ã€å¼·åŒ–éŒ¯èª¤è™•ç†

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸå§‹é‡æ§‹è¦åŠƒ

## ğŸ“ éšæ®µä¸€ï¼šæ–‡æª”æ•´ç†ï¼ˆå„ªå…ˆç´šï¼šHIGHï¼‰

### Task 1.1ï¼šå»ºç«‹å–®ä¸€ç´¢å¼•æ–‡ä»¶

**ç›®æ¨™**ï¼šå°‡æ‰€æœ‰æ–‡æª”æ•´åˆæˆä¸€ä»½ `README.md`

**æ­¥é©Ÿ**ï¼š

1. åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹æ–°çš„ `README.md`

2. åŒ…å«ä»¥ä¸‹ç« ç¯€ï¼š
```markdown
# é‡‘æµä¸²æ¥ç³»çµ±

## å¿«é€Ÿé–‹å§‹
- ç’°å¢ƒè®Šæ•¸è¨­å®š
- å®‰è£ä¾è³´
- åˆå§‹åŒ– Google Sheets
- å•Ÿå‹•æœå‹™

## æ¶æ§‹èªªæ˜
- è³‡æ–™å¤¾çµæ§‹
- æŠ€è¡“æ£§
- è³‡æ–™æµå‘

## API æ–‡æª”
- èªè­‰ API
- æ”¯ä»˜ API
- è¨‚é–± API
- Webhook

## é–‹ç™¼æŒ‡å—
- æ–°å¢å•†å“
- æ¸¬è©¦æ”¯ä»˜æµç¨‹
- è¨‚é–±åˆ¶é…ç½®

## éƒ¨ç½²
- ç’°å¢ƒè®Šæ•¸æ¸…å–®
- Google Cloud è¨­å®š
- PAYUNi è¨­å®š
```

3. **åˆªé™¤ä»¥ä¸‹å†—é¤˜æ–‡æª”**ï¼ˆå…§å®¹å·²æ•´åˆï¼‰ï¼š
   - âŒ `code-review-agent.md`
   - âŒ `CodeMender.md`
   - âŒ `improve.md`
   - âŒ `planning-agent.md`
   - âŒ `google-console.md`ï¼ˆå…§å®¹ç§»è‡³ READMEï¼‰
   - âŒ `Notion_Page_Structure.md`ï¼ˆéç¨‹å¼ç¢¼ç›¸é—œï¼‰

### Task 1.2ï¼šä¿ç•™é—œéµé…ç½®æ–‡æª”

**ä¿ç•™**ï¼š
- âœ… `.env.example`ï¼ˆç’°å¢ƒè®Šæ•¸ç¯„æœ¬ï¼‰
- âœ… `README.md`ï¼ˆæ–°å»ºçš„ç´¢å¼•æ–‡æª”ï¼‰
- âœ… `é‡æ§‹è¦åŠƒ.md`ï¼ˆæœ¬æ–‡ä»¶ï¼‰

---

## ğŸ”§ éšæ®µäºŒï¼šå¾Œç«¯ç¨‹å¼ç¢¼é‡æ§‹ï¼ˆå„ªå…ˆç´šï¼šMEDIUMï¼‰

### Task 2.1ï¼šæå–å¸¸æ•¸èˆ‡é…ç½®

**æ–‡ä»¶**ï¼š`src/config/constants.js`

**æ”¹é€²é»**ï¼š
```javascript
// ç¾ç‹€ï¼šconstants.js å·²ç¶“åšå¾—å¾ˆå¥½
// å»ºè­°ï¼šæ–°å¢ JSDoc è¨»é‡‹

/**
 * ä¼ºæœå™¨é…ç½®
 * @typedef {Object} ServerConfig
 * @property {number} PORT - ä¼ºæœå™¨ç›£è½åŸ è™Ÿ
 * @property {string} NODE_ENV - åŸ·è¡Œç’°å¢ƒ
 * @property {string} DOMAIN - ç¶²åŸŸåç¨±
 */
export const SERVER_CONFIG = {
  PORT: 80,
  NODE_ENV: process.env.NODE_ENV || "development",
  DOMAIN: process.env.DOMAIN || "https://example.com",
};
```

### Task 2.2ï¼šå„ªåŒ– PayuniSDK

**æ–‡ä»¶**ï¼š`src/services/payment/PayuniSDK.js`

**æ”¹é€²é»**ï¼š

1. **æå–å…±ç”¨é‚è¼¯**
```javascript
// ç¾ç‹€ï¼šé‡è¤‡çš„éŒ¯èª¤è™•ç†
// å»ºè­°ï¼šæå–ç‚ºç§æœ‰æ–¹æ³•
_handleApiError(error, context) {
  logger.error(`${context} å¤±æ•—`, { error: error.message });
  return {
    success: false,
    error: error.message,
  };
}
```

2. **çµ±ä¸€å›æ‡‰æ ¼å¼**
```javascript
// å»ºè­°ï¼šæ‰€æœ‰ async æ–¹æ³•éƒ½è¿”å›æ¨™æº–æ ¼å¼
{
  success: boolean,
  data?: any,
  error?: string
}
```

### Task 2.3ï¼šç°¡åŒ– Webhook è™•ç†é‚è¼¯

**æ–‡ä»¶**ï¼š`src/routes/payment.js:131`

**æ”¹é€²é»**ï¼š
```javascript
// ç¾ç‹€ï¼špayuni-webhook è™•ç†é‚è¼¯éé•·ï¼ˆ150+ è¡Œï¼‰
// å»ºè­°ï¼šæå–ç‚ºç¨ç«‹ service

// æ–°å»ºï¼šsrc/services/webhookHandler.js
export class WebhookHandler {
  async processPayment(webhookData) {
    // 1. é©—è­‰è³‡æ–™
    // 2. æŸ¥è©¢è¨‚å–®
    // 3. æ›´æ–°è¨‚å–®
    // 4. æˆäºˆæ¬Šç›Š
  }
}
```

### Task 2.4ï¼šå¼·åŒ–éŒ¯èª¤è™•ç†

**æ–‡ä»¶**ï¼š`src/utils/errors.js`

**æ”¹é€²é»**ï¼š
```javascript
// æ–°å¢æ›´å¤šèªç¾©åŒ–çš„éŒ¯èª¤é¡å‹
export const PaymentErrors = {
  // ç¾æœ‰çš„...

  ProductNotFound: (productId) =>
    new PaymentError(404, 'å•†å“ä¸å­˜åœ¨', { productId }),

  OrderAlreadyPaid: (tradeNo) =>
    new PaymentError(409, 'è¨‚å–®å·²æ”¯ä»˜', { tradeNo }),

  InvalidWebhookSignature: () =>
    new PaymentError(401, 'Webhook ç°½ç« é©—è­‰å¤±æ•—'),
};
```

---

## ğŸ¨ éšæ®µä¸‰ï¼šå‰ç«¯ç¨‹å¼ç¢¼é‡æ§‹ï¼ˆå„ªå…ˆç´šï¼šHIGHï¼‰

### Task 3.1ï¼šæ¨¡çµ„åŒ–å‰ç«¯ JavaScript

**æ–‡ä»¶**ï¼š`_frontend/public/app.js`

**ç¾ç‹€å•é¡Œ**ï¼š
- å–®ä¸€æª”æ¡ˆ 412 è¡Œ
- å…¨åŸŸè®Šæ•¸æ±¡æŸ“
- é›£ä»¥ç¶­è­·å’Œæ¸¬è©¦

**é‡æ§‹æ–¹æ¡ˆ**ï¼šæ‹†åˆ†ç‚ºå¤šå€‹æ¨¡çµ„

#### æ­¥é©Ÿ 1ï¼šå»ºç«‹æ¨¡çµ„è³‡æ–™å¤¾çµæ§‹

```
_frontend/public/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth.js        # èªè­‰é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ products.js    # å•†å“é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ payment.js     # æ”¯ä»˜é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ orders.js      # è¨‚å–®æ­·å²
â”‚   â”‚   â””â”€â”€ ui.js          # UI å·¥å…·å‡½æ•¸
â”‚   â””â”€â”€ main.js            # ä¸»é€²å…¥é»
â”œâ”€â”€ app.js                 # (åˆªé™¤ï¼Œæ”¹ç‚º main.js)
â””â”€â”€ ...
```

#### æ­¥é©Ÿ 2ï¼šæ‹†åˆ† auth.js

```javascript
// _frontend/public/js/modules/auth.js
export class AuthManager {
  constructor() {
    this.currentUser = null;
  }

  async checkLoginStatus() {
    try {
      const res = await fetch("/api/me");
      if (!res.ok) return null;
      const data = await res.json();
      return data.loggedIn ? data.user : null;
    } catch (e) {
      return null;
    }
  }

  updateUI(user, elements) {
    this.currentUser = user;

    if (user) {
      elements.guestView.classList.add("hidden");
      elements.userView.classList.remove("hidden");
      elements.userAvatar.src = user.picture || "";
      elements.userName.textContent = user.name;

      // Check subscription
      const hasActiveSubscription = user.entitlements?.some(
        e => e.type === 'subscription' && e.status === 'active'
      );
      if (hasActiveSubscription) {
        this._addPremiumBadge(elements.userName);
      }
    } else {
      elements.userView.classList.add("hidden");
      elements.guestView.classList.remove("hidden");
    }
  }

  _addPremiumBadge(element) {
    const badge = document.createElement("span");
    badge.className = "status-badge status-active";
    badge.style.marginLeft = "8px";
    badge.style.fontSize = "12px";
    badge.textContent = "Premium";
    element.appendChild(badge);
  }
}
```

#### æ­¥é©Ÿ 3ï¼šæ‹†åˆ† products.js

```javascript
// _frontend/public/js/modules/products.js
export class ProductManager {
  constructor() {
    this.products = [];
    this.selectedProductId = null;
    this.currentTab = 'subscription';
  }

  async fetchProducts() {
    const res = await fetch("/api/products");
    if (!res.ok) throw new Error("Failed to load products");
    this.products = await res.json();
    return this.products;
  }

  setTab(tab) {
    this.currentTab = tab;
  }

  getFilteredProducts() {
    return this.products.filter(p => {
      if (this.currentTab === 'subscription') {
        return p.type === 'subscription' || !p.type;
      }
      return p.type === 'one_time';
    });
  }

  selectProduct(productId) {
    this.selectedProductId = productId;
    const product = this.products.find(p => p.id === productId);
    return product;
  }

  renderProducts(container, currentUser) {
    container.innerHTML = "";
    const filtered = this.getFilteredProducts();

    if (filtered.length === 0) {
      container.innerHTML = `<div class="error show">æ²’æœ‰æ‰¾åˆ°å•†å“</div>`;
      return;
    }

    filtered.forEach(product => {
      if (this.currentTab === 'subscription') {
        this._renderSubscriptionCard(product, container, currentUser);
      } else {
        this._renderOneTimeCard(product, container, currentUser);
      }
    });
  }

  _renderSubscriptionCard(product, container, currentUser) {
    // å¯¦ä½œè¨‚é–±å¡ç‰‡æ¸²æŸ“...
  }

  _renderOneTimeCard(product, container, currentUser) {
    // å¯¦ä½œä¸€æ¬¡æ€§è³¼è²·å¡ç‰‡æ¸²æŸ“...
  }
}
```

#### æ­¥é©Ÿ 4ï¼šæ‹†åˆ† payment.js

```javascript
// _frontend/public/js/modules/payment.js
export class PaymentManager {
  constructor(csrfToken, clientConfig) {
    this.csrfToken = csrfToken;
    this.clientConfig = clientConfig;
  }

  async createPayment(productId, products) {
    const product = products.find(p => p.id === productId);
    if (!product) throw new Error("å•†å“ä¸å­˜åœ¨");

    const turnstileToken = turnstile.getResponse();

    if (this.clientConfig.turnstileEnable && !turnstileToken) {
      throw new Error("è«‹å®Œæˆå®‰å…¨é©—è­‰");
    }

    const endpoint = product.type === 'subscription'
      ? '/create-subscription'
      : '/create-payment';

    const res = await fetch(endpoint, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRF-Token": this.csrfToken,
      },
      body: JSON.stringify({
        productID: productId,
        turnstileToken: turnstileToken
      }),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "æ”¯ä»˜å»ºç«‹å¤±æ•—");

    return data;
  }

  redirectToPayment(paymentData) {
    const { payUrl, data } = paymentData;
    const form = document.createElement("form");
    form.method = "POST";
    form.action = payUrl;

    Object.entries(data).forEach(([key, value]) => {
      const input = document.createElement("input");
      input.type = "hidden";
      input.name = key;
      input.value = value;
      form.appendChild(input);
    });

    document.body.appendChild(form);
    form.submit();
  }
}
```

#### æ­¥é©Ÿ 5ï¼šå»ºç«‹ ui.js å·¥å…·æ¨¡çµ„

```javascript
// _frontend/public/js/modules/ui.js
export function showLoading() {
  const modal = document.getElementById("loading-modal");
  modal?.classList.add("show");
}

export function hideLoading() {
  const modal = document.getElementById("loading-modal");
  modal?.classList.remove("show");
}

export function showError(message) {
  const errorEl = document.getElementById("error-message");
  if (errorEl) {
    errorEl.textContent = message;
    errorEl.classList.add("show");
  }
  hideLoading();
}

export function clearError() {
  const errorEl = document.getElementById("error-message");
  errorEl?.classList.remove("show");
}
```

#### æ­¥é©Ÿ 6ï¼šå»ºç«‹ä¸»é€²å…¥é» main.js

```javascript
// _frontend/public/js/main.js
import { AuthManager } from './modules/auth.js';
import { ProductManager } from './modules/products.js';
import { PaymentManager } from './modules/payment.js';
import { showLoading, hideLoading, showError, clearError } from './modules/ui.js';

document.addEventListener("DOMContentLoaded", async () => {
  // åˆå§‹åŒ–ç®¡ç†å™¨
  const authManager = new AuthManager();
  const productManager = new ProductManager();
  let paymentManager;

  // UI Elements
  const elements = {
    // ... æ‰€æœ‰ DOM å…ƒç´ 
  };

  // åˆå§‹åŒ–
  showLoading();

  const [csrfRes, configRes] = await Promise.all([
    fetch("/csrf-token"),
    fetch("/api/client-config")
  ]);

  const csrfData = await csrfRes.json();
  const clientConfig = await configRes.json();

  paymentManager = new PaymentManager(csrfData.csrfToken, clientConfig);

  const user = await authManager.checkLoginStatus();
  await productManager.fetchProducts();

  authManager.updateUI(user, elements);
  productManager.renderProducts(elements.productOptions, user);

  hideLoading();

  // Event Listeners
  elements.payBtn.addEventListener("click", async () => {
    try {
      clearError();
      elements.payBtn.disabled = true;
      showLoading();

      const paymentData = await paymentManager.createPayment(
        productManager.selectedProductId,
        productManager.products
      );

      paymentManager.redirectToPayment(paymentData);
    } catch (error) {
      showError(error.message);
      elements.payBtn.disabled = false;
    }
  });
});
```

#### æ­¥é©Ÿ 7ï¼šæ›´æ–° HTML å¼•ç”¨

```html
<!-- _frontend/index.html -->
<script type="module" src="/js/main.js"></script>
```

---

## ğŸ“ˆ éšæ®µå››ï¼šç¨‹å¼ç¢¼å“è³ªæå‡ï¼ˆå„ªå…ˆç´šï¼šMEDIUMï¼‰

### Task 4.1ï¼šæ–°å¢ JSDoc è¨»é‡‹

**ç¯„ä¾‹**ï¼š
```javascript
/**
 * å»ºç«‹æ”¯ä»˜è¨‚å–®
 * @param {Object} req - Express è«‹æ±‚ç‰©ä»¶
 * @param {Object} req.body - è«‹æ±‚ä¸»é«”
 * @param {string} req.body.productID - å•†å“ ID
 * @param {string} req.body.turnstileToken - Turnstile é©—è­‰ Token
 * @param {Object} res - Express å›æ‡‰ç‰©ä»¶
 * @param {Function} next - ä¸‹ä¸€å€‹ä¸­é–“ä»¶
 * @returns {Promise<void>}
 */
router.post("/create-payment", paymentLimiter, async (req, res, next) => {
  // ...
});
```

### Task 4.2ï¼šçµ±ä¸€å‘½åè¦ç¯„

**è¦å‰‡**ï¼š
- æª”æ¡ˆåç¨±ï¼škebab-caseï¼ˆ`payment-helpers.js`ï¼‰
- é¡åˆ¥åç¨±ï¼šPascalCaseï¼ˆ`PayuniSDK`ï¼‰
- å‡½æ•¸åç¨±ï¼šcamelCaseï¼ˆ`createOrder`ï¼‰
- å¸¸æ•¸ï¼šUPPER_SNAKE_CASEï¼ˆ`SERVER_CONFIG`ï¼‰

### Task 4.3ï¼šæ–°å¢å–®å…ƒæ¸¬è©¦ï¼ˆé¸åšï¼‰

**å»ºè­°å·¥å…·**ï¼šVitest æˆ– Jest

**æ¸¬è©¦ç¯„ä¾‹**ï¼š
```javascript
// tests/utils/paymentHelpers.test.js
import { describe, it, expect } from 'vitest';
import { generateTradeNo } from '../src/utils/paymentHelpers.js';

describe('paymentHelpers', () => {
  describe('generateTradeNo', () => {
    it('should generate unique trade numbers', () => {
      const tradeNo1 = generateTradeNo();
      const tradeNo2 = generateTradeNo();
      expect(tradeNo1).not.toBe(tradeNo2);
    });

    it('should match expected format', () => {
      const tradeNo = generateTradeNo();
      expect(tradeNo).toMatch(/^PAY\d{17}$/);
    });
  });
});
```

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šç¹é«”ä¸­æ–‡å‹å¥½åŒ–æ”¹é€ 

## ğŸŒ éšæ®µäº”ï¼šå…¨é¢ç¹é«”ä¸­æ–‡åŒ–ï¼ˆå„ªå…ˆç´šï¼šHIGHï¼‰

### ä¸­æ–‡åŒ–åŸå‰‡

- âœ… æ‰€æœ‰è¨»é‡‹ä½¿ç”¨ç¹é«”ä¸­æ–‡
- âœ… æ‰€æœ‰ä½¿ç”¨è€…å¯è¦‹è¨Šæ¯ä½¿ç”¨ç¹é«”ä¸­æ–‡
- âœ… è®Šæ•¸åç¨±å¯é¸ï¼šä¿æŒè‹±æ–‡ + ä¸­æ–‡è¨»é‡‹
- âœ… éŒ¯èª¤è¨Šæ¯ã€æ—¥èªŒè¨Šæ¯å…¨éƒ¨ç¹é«”ä¸­æ–‡
- âš ï¸ æŠ€è¡“è¡“èªä¿ç•™è‹±æ–‡ï¼ˆAPIã€webhookã€tokenã€CSRF ç­‰ï¼‰

### Task 5.1ï¼šå¾Œç«¯å¸¸æ•¸èˆ‡é…ç½®ä¸­æ–‡åŒ–

**æ–‡ä»¶**ï¼š`src/config/constants.js`

**æ”¹é€ æ–¹æ¡ˆ Aï¼šä¿ç•™è‹±æ–‡ + ä¸­æ–‡è¨»é‡‹**ï¼ˆæ¨è–¦ï¼‰

```javascript
/**
 * ä¼ºæœå™¨é…ç½®
 */
export const SERVER_CONFIG = {
  /** ä¼ºæœå™¨ç›£è½åŸ è™Ÿ */
  PORT: 80,
  /** åŸ·è¡Œç’°å¢ƒï¼ˆé–‹ç™¼/æ­£å¼ï¼‰ */
  NODE_ENV: process.env.NODE_ENV || "development",
  /** ç¶²åŸŸåç¨± */
  DOMAIN: process.env.DOMAIN || "https://example.com",
};

/**
 * PAYUNi é‡‘æµé…ç½®
 */
export const PAYUNI_CONFIG = {
  /** API ç¶²å€ */
  API_URL: process.env.PAYUNI_API_URL,
  /** å•†åº— ID */
  MERCHANT_ID: process.env.PAYUNI_MERCHANT_ID,
  /** é›œæ¹Šå¯†é‘° */
  HASH_KEY: process.env.PAYUNI_HASH_KEY,
  /** é›œæ¹Šå‘é‡ */
  HASH_IV: process.env.PAYUNI_HASH_IV,
  /** è¿”å›ç¶²å€ */
  RETURN_URL: process.env.PAYUNI_RETURN_URL || "https://example.com",
};
```
### Task 5.2ï¼šéŒ¯èª¤è¨Šæ¯ä¸­æ–‡åŒ–

**æ–‡ä»¶**ï¼š`src/utils/errors.js`

### Task 5.3ï¼šæ—¥èªŒè¨Šæ¯ä¸­æ–‡åŒ–

**é‡é»**ï¼šæ‰€æœ‰ `logger` å‘¼å«éƒ½ä½¿ç”¨ä¸­æ–‡

**ç¯„ä¾‹æ”¹é€ **ï¼š

```javascript
// âŒ æ”¹é€ å‰
logger.info("Payment created successfully", { tradeNo, amount });
logger.error("Failed to create order", { error: error.message });

// âœ… æ”¹é€ å¾Œ
logger.info("æ”¯ä»˜è¨‚å–®å»ºç«‹æˆåŠŸ", { è¨‚å–®ç·¨è™Ÿ: tradeNo, é‡‘é¡: amount });
logger.error("å»ºç«‹è¨‚å–®å¤±æ•—", { éŒ¯èª¤è¨Šæ¯: error.message });
```

### Task 5.4ï¼šå‰ç«¯æ¨¡çµ„ä¸­æ–‡åŒ–

**æ–‡ä»¶**ï¼š`_frontend/public/js/modules/auth.js`

### Task 5.5ï¼šHTML ä»‹é¢ä¸­æ–‡åŒ–

**æ–‡ä»¶**ï¼š`_frontend/index.html`

**æ”¹é€ é‡é»**ï¼šæ‰€æœ‰ä½¿ç”¨è€…å¯è¦‹æ–‡å­—éƒ½ä½¿ç”¨ç¹é«”ä¸­æ–‡

```html
<!-- æ­¥é©Ÿ 1ï¼šç™»å…¥é©—è­‰ -->
<section id="auth-section" class="step-section">
  <h2 class="step-title">
    <span class="step-number">1</span>
    ç™»å…¥é©—è­‰
  </h2>

  <!-- è¨ªå®¢è¦–åœ– -->
  <div id="guest-view" class="auth-view">
    <p class="info-text">è«‹å…ˆç™»å…¥ Google å¸³è™Ÿä»¥ç¹¼çºŒè³¼è²·æµç¨‹</p>
    <button id="login-btn" class="btn btn-primary">
      ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
    </button>
  </div>

  <!-- å·²ç™»å…¥è¦–åœ– -->
  <div id="user-view" class="auth-view hidden">
    <div class="user-info">
      <img id="user-avatar" src="" alt="ä½¿ç”¨è€…é ­åƒ" class="user-avatar">
      <span id="user-name" class="user-name"></span>
    </div>
    <div class="user-actions">
      <button id="my-orders-btn" class="btn btn-secondary">æˆ‘çš„è¨‚å–®</button>
      <button id="logout-btn" class="btn btn-ghost">ç™»å‡º</button>
    </div>
  </div>
</section>

<!-- æ­¥é©Ÿ 2ï¼šé¸æ“‡æ–¹æ¡ˆ -->
<section id="plan-section" class="step-section disabled">
  <h2 class="step-title">
    <span class="step-number">2</span>
    é¸æ“‡æ–¹æ¡ˆ
  </h2>

  <div class="tabs">
    <button class="tab-btn active" data-tab="subscription">è¨‚é–±åˆ¶</button>
    <button class="tab-btn" data-tab="one_time">å–®æ¬¡è³¼è²·</button>
  </div>

  <div id="product-options" class="product-grid">
    <!-- å•†å“åˆ—è¡¨å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
  </div>
</section>

<!-- æ­¥é©Ÿ 3ï¼šç¢ºèªä»˜æ¬¾ -->
<section id="payment-section" class="step-section disabled">
  <h2 class="step-title">
    <span class="step-number">3</span>
    ç¢ºèªä»˜æ¬¾
  </h2>

  <div class="payment-summary">
    <div class="summary-row">
      <span>ç¸½é‡‘é¡</span>
      <span id="total-amount" class="amount">$0</span>
    </div>
  </div>

  <button id="pay-btn" class="btn btn-primary btn-large" disabled>
    å‰å¾€ä»˜æ¬¾
  </button>

  <div id="error-message" class="error"></div>
</section>
```

---


## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. æŠ€è¡“è¡“èªè™•ç†

**ä¿ç•™è‹±æ–‡çš„è¡“èª**ï¼š
- APIã€SDKã€Tokenã€CSRFã€OAuthã€JWT
- Webhookã€Callbackã€Promiseã€Async
- HTTPã€URLã€JSONã€UUID

**å¯ä¸­æ–‡åŒ–çš„è¡“èª**ï¼š
- User â†’ ä½¿ç”¨è€…
- Order â†’ è¨‚å–®
- Product â†’ å•†å“
- Payment â†’ æ”¯ä»˜
- Subscription â†’ è¨‚é–±
- Error â†’ éŒ¯èª¤

### 2. è®Šæ•¸å‘½åç­–ç•¥

**æ··åˆåœ˜éšŠ**ï¼šä½¿ç”¨è‹±æ–‡è­˜åˆ¥ç¬¦ + å®Œæ•´ä¸­æ–‡è¨»é‡‹

---

## ğŸ“¦ æœ€çµ‚æª”æ¡ˆçµæ§‹

```
é‡‘æµä¸²æ¥/
â”œâ”€â”€ README.md                   # â­ å”¯ä¸€çš„ä¸»è¦æ–‡æª”
â”œâ”€â”€ é‡æ§‹è¦åŠƒ.md                 # â­ æœ¬æ–‡ä»¶
â”œâ”€â”€ .env.example                # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ package.json
â”œâ”€â”€ index.js                    # æ‡‰ç”¨é€²å…¥é»
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ constants.js        # â­ ä¸­æ–‡åŒ–
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ products.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â”‚   â””â”€â”€ security.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ orders.js
â”‚   â”‚   â”œâ”€â”€ payment.js          # â­ ä¸­æ–‡åŒ–
â”‚   â”‚   â””â”€â”€ subscriptions.js
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ webhookHandler.js   # â­ æ–°å¢ï¼ˆä¸­æ–‡åŒ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ provider.js
â”‚   â”‚   â”‚   â””â”€â”€ GoogleSheets.js
â”‚   â”‚   â””â”€â”€ payment/
â”‚   â”‚       â”œâ”€â”€ provider.js
â”‚   â”‚       â””â”€â”€ PayuniSDK.js
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ crypto.js
â”‚       â”œâ”€â”€ errors.js           # â­ ä¸­æ–‡åŒ–
â”‚       â”œâ”€â”€ logger.js
â”‚       â”œâ”€â”€ paymentHelpers.js   # â­ ä¸­æ–‡åŒ–
â”‚       â”œâ”€â”€ startup.js
â”‚       â”œâ”€â”€ turnstile.js
â”‚       â””â”€â”€ validators.js
â”œâ”€â”€ _frontend/
â”‚   â”œâ”€â”€ index.html              # â­ ä¸­æ–‡åŒ–
â”‚   â”œâ”€â”€ orders.html
â”‚   â”œâ”€â”€ subscriptions.html
â”‚   â”œâ”€â”€ result.html
â”‚   â””â”€â”€ public/
â”‚       â”œâ”€â”€ js/
â”‚       â”‚   â”œâ”€â”€ main.js         # â­ æ–°å¢ï¼ˆä¸­æ–‡åŒ–ï¼‰
â”‚       â”‚   â””â”€â”€ modules/        # â­ æ–°å¢ï¼ˆä¸­æ–‡åŒ–ï¼‰
â”‚       â”‚       â”œâ”€â”€ auth.js
â”‚       â”‚       â”œâ”€â”€ products.js
â”‚       â”‚       â”œâ”€â”€ payment.js
â”‚       â”‚       â”œâ”€â”€ orders.js
â”‚       â”‚       â””â”€â”€ ui.js
â”‚       â”œâ”€â”€ style.css
â”‚       â”œâ”€â”€ landing.css
â”‚       â”œâ”€â”€ orders.js           # â­ å¯æ¨¡çµ„åŒ–
â”‚       â”œâ”€â”€ subscriptions.js    # â­ å¯æ¨¡çµ„åŒ–
â”‚       â”œâ”€â”€ result.js
â”‚       â””â”€â”€ images/
â””â”€â”€ tests/                      # â­ æ–°å¢ï¼ˆé¸åšï¼‰
    â”œâ”€â”€ utils/
    â””â”€â”€ services/
```

---

## ğŸ¯ åŸ·è¡Œé †åºèˆ‡æ™‚é–“è¦åŠƒ

### Week 1ï¼šæ–‡æª”èˆ‡åŸºç¤ä¸­æ–‡åŒ–
**æ™‚é–“**ï¼šæ¯å¤© 2-4 å°æ™‚

1. âœ… **Day 1-2**ï¼šTask 1.1 + 1.2 - æ–‡æª”æ•´ç†
   - å»ºç«‹ README.md
   - åˆªé™¤å†—é¤˜æ–‡æª”
   - æ¸¬è©¦æ–‡ä»¶æ˜¯å¦æ­£ç¢º

2. âœ… **Day 3-4**ï¼šTask 5.1 + 5.2 - å¾Œç«¯åŸºç¤ä¸­æ–‡åŒ–
   - æ”¹é€  `constants.js`
   - æ”¹é€  `errors.js`
   - æ›´æ–°æ‰€æœ‰ import è·¯å¾‘

3. âœ… **Day 5-7**ï¼šTask 5.3 - æ—¥èªŒè¨Šæ¯ä¸­æ–‡åŒ–
   - æœå°‹æ‰€æœ‰ `logger` å‘¼å«
   - é€ä¸€æ”¹ç‚ºä¸­æ–‡è¨Šæ¯
   - æ¸¬è©¦æ—¥èªŒè¼¸å‡º

### Week 2ï¼šå‰ç«¯æ¨¡çµ„åŒ–èˆ‡ä¸­æ–‡åŒ–
**æ™‚é–“**ï¼šæ¯å¤© 2-4 å°æ™‚

4. âœ… **Day 8-10**ï¼šTask 3.1 (Steps 1-3) - å»ºç«‹å‰ç«¯æ¨¡çµ„çµæ§‹
   - å»ºç«‹ `modules/` è³‡æ–™å¤¾
   - å»ºç«‹ `auth.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰
   - å»ºç«‹ `products.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰

5. âœ… **Day 11-12**ï¼šTask 3.1 (Steps 4-5) - å®Œæˆå‰ç«¯æ¨¡çµ„
   - å»ºç«‹ `payment.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰
   - å»ºç«‹ `ui.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰

6. âœ… **Day 13-14**ï¼šTask 3.1 (Steps 6-7) + Task 5.5 - æ•´åˆèˆ‡ HTML
   - å»ºç«‹ `main.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰
   - æ›´æ–° `index.html`ï¼ˆä¸­æ–‡åŒ–ï¼‰
   - æ¸¬è©¦å‰ç«¯åŠŸèƒ½

### Week 3ï¼šå¾Œç«¯é‡æ§‹èˆ‡å“è³ªæå‡
**æ™‚é–“**ï¼šæ¯å¤© 2-4 å°æ™‚

7. âœ… **Day 15-17**ï¼šTask 2.3 - Webhook é‚è¼¯æå–
   - å»ºç«‹ `webhookHandler.js`ï¼ˆä¸­æ–‡åŒ–ï¼‰
   - é‡æ§‹ `payment.js` è·¯ç”±
   - æ¸¬è©¦ Webhook åŠŸèƒ½

8. âœ… **Day 18-19**ï¼šTask 2.2 + 2.4 - SDK å„ªåŒ–
   - å„ªåŒ– `PayuniSDK.js`
   - æå–å…±ç”¨éŒ¯èª¤è™•ç†
   - æ–°å¢éŒ¯èª¤é¡å‹

9. âœ… **Day 20-21**ï¼šTask 4.1 + 4.2 - å“è³ªæå‡
   - æ–°å¢ JSDocï¼ˆä¸­æ–‡ï¼‰
   - çµ±ä¸€å‘½åè¦ç¯„
   - Code Review

### Week 4ï¼šæ¸¬è©¦èˆ‡æ–‡æª”å®Œå–„ï¼ˆé¸åšï¼‰
**æ™‚é–“**ï¼šæ¯å¤© 1-2 å°æ™‚

10. âœ… **Day 22-24**ï¼šTask 4.3 - å–®å…ƒæ¸¬è©¦
    - å®‰è£æ¸¬è©¦æ¡†æ¶
    - æ’°å¯«é—œéµå‡½æ•¸æ¸¬è©¦
    - åŸ·è¡Œæ¸¬è©¦ç¢ºä¿åŠŸèƒ½æ­£å¸¸

11. âœ… **Day 25-28**ï¼šæœ€çµ‚æª¢æŸ¥
    - å®Œæ•´åŠŸèƒ½æ¸¬è©¦
    - ä¸­æ–‡åŒ–æª¢æŸ¥
    - æ›´æ–° README.md
    - å»ºç«‹éƒ¨ç½²æ–‡æª”

---

## âœ… é©—æ”¶æ¨™æº–

### æ–‡æª”
- [ ] åªä¿ç•™ `README.md`ã€`.env.example`ã€`é‡æ§‹è¦åŠƒ.md`
- [ ] README åŒ…å«å®Œæ•´çš„è¨­å®šã€APIã€éƒ¨ç½²èªªæ˜
- [ ] æ‰€æœ‰å†—é¤˜æ–‡æª”å·²åˆªé™¤
- [ ] README å®Œå…¨ä½¿ç”¨ç¹é«”ä¸­æ–‡

### å‰ç«¯
- [ ] `app.js` æ‹†åˆ†ç‚º 5 å€‹æ¨¡çµ„
- [ ] ä½¿ç”¨ ES6 æ¨¡çµ„ï¼ˆ`import/export`ï¼‰
- [ ] æ‰€æœ‰æ¨¡çµ„å®Œå…¨ä¸­æ–‡åŒ–
- [ ] ç„¡å…¨åŸŸè®Šæ•¸æ±¡æŸ“
- [ ] HTML æ‰€æœ‰æ–‡å­—ä½¿ç”¨ç¹é«”ä¸­æ–‡
- [ ] åŠŸèƒ½æ¸¬è©¦é€šé

### å¾Œç«¯
- [ ] Webhook é‚è¼¯æå–ç‚ºç¨ç«‹ service
- [ ] æ‰€æœ‰å…¬é–‹æ–¹æ³•æœ‰ä¸­æ–‡ JSDoc
- [ ] éŒ¯èª¤è™•ç†çµ±ä¸€ä½¿ç”¨ä¸­æ–‡åŒ–çš„ `éŒ¯èª¤é¡å‹`
- [ ] å›æ‡‰æ ¼å¼ä¸€è‡´
- [ ] æ‰€æœ‰ logger è¨Šæ¯ä½¿ç”¨ä¸­æ–‡
- [ ] å¸¸æ•¸èˆ‡é…ç½®ä¸­æ–‡åŒ–

### ç¨‹å¼ç¢¼å“è³ª
- [ ] å‘½åè¦ç¯„çµ±ä¸€ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡+ä¸­æ–‡è¨»é‡‹ï¼‰
- [ ] ç„¡é‡è¤‡é‚è¼¯
- [ ] Logger æ­£ç¢ºä½¿ç”¨
- [ ] ç¨‹å¼ç¢¼å¯è®€æ€§æå‡
- [ ] æ‰€æœ‰è¨»é‡‹ä½¿ç”¨ç¹é«”ä¸­æ–‡

### ä¸­æ–‡åŒ–
- [ ] ä½¿ç”¨è€…å¯è¦‹æ–‡å­— 100% ç¹é«”ä¸­æ–‡
- [ ] éŒ¯èª¤è¨Šæ¯ 100% ç¹é«”ä¸­æ–‡
- [ ] æ—¥èªŒè¨Šæ¯ 100% ç¹é«”ä¸­æ–‡
- [ ] è¨»é‡‹ 100% ç¹é«”ä¸­æ–‡
- [ ] æŠ€è¡“è¡“èªä¿æŒä¸€è‡´æ€§

---

## ğŸš€ åŸ·è¡Œé‡æ§‹çš„æœ€ä½³å¯¦è¸

### 1. æ¯æ¬¡åªåšä¸€å€‹ Task
é¿å…å¤§è¦æ¨¡æ”¹å‹•å°è‡´é›£ä»¥é™¤éŒ¯

### 2. æ¸¬è©¦å…ˆè¡Œ
æ¯å®Œæˆä¸€å€‹ Task å°±æ¸¬è©¦ç›¸é—œåŠŸèƒ½ï¼Œç¢ºä¿æ²’æœ‰ç ´å£æ—¢æœ‰åŠŸèƒ½

### 3. ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶
```bash
# æ¯å€‹ Task å®Œæˆå¾Œ commit
git add .
git commit -m "feat: å®Œæˆ Task 1.1 - å»ºç«‹ README.md"

# å»ºè­°ä½¿ç”¨ branch
git checkout -b refactor/frontend-modules
```

### 4. ä¿ç•™èˆŠæª”æ¡ˆï¼ˆéæ¸¡æœŸï¼‰
```bash
# é‡æ§‹å‰å…ˆå‚™ä»½
cp app.js app.js.backup

# æˆ–ä½¿ç”¨ Git branch
git checkout -b backup/before-refactor
```

### 5. æ¼¸é€²å¼é‡æ§‹
ä¸è¦ä¸€æ¬¡æ”¹å‹•å¤ªå¤šæª”æ¡ˆï¼Œå»ºè­°é †åºï¼š
1. å…ˆæ”¹æ–‡æª”
2. å†æ”¹å¾Œç«¯å¸¸æ•¸èˆ‡éŒ¯èª¤
3. ç„¶å¾Œæ”¹å‰ç«¯æ¨¡çµ„
4. æœ€å¾Œå“è³ªæå‡

### 6. æ¸¬è©¦æ¸…å–®
æ¯å€‹éšæ®µå®Œæˆå¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹æ¸¬è©¦ï¼š
- [ ] ä½¿ç”¨è€…ç™»å…¥ç™»å‡º
- [ ] å•†å“åˆ—è¡¨é¡¯ç¤º
- [ ] ä¸€æ¬¡æ€§æ”¯ä»˜æµç¨‹
- [ ] è¨‚é–±åˆ¶æ”¯ä»˜æµç¨‹
- [ ] Webhook é€šçŸ¥è™•ç†
- [ ] è¨‚å–®æ­·å²æŸ¥è©¢

---

## ğŸ“š åƒè€ƒè³‡æº

- **ES6 æ¨¡çµ„**ï¼šhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules
- **JSDoc**ï¼šhttps://jsdoc.app/
- **Express æœ€ä½³å¯¦è¸**ï¼šhttps://expressjs.com/en/advanced/best-practice-performance.html
- **JavaScript ç¹é«”ä¸­æ–‡å‘½åè¦ç¯„**ï¼šæ”¯æ´ Unicode è­˜åˆ¥ç¬¦ï¼Œä½†å»ºè­°åœ˜éšŠçµ±ä¸€æ¨™æº–

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ FAQ

### Q1: ä¸­æ–‡è®Šæ•¸åç¨±æœƒæœ‰å…¼å®¹æ€§å•é¡Œå—ï¼Ÿ
**A**: ç¾ä»£ JavaScript (ES6+) å®Œå…¨æ”¯æ´ Unicode è­˜åˆ¥ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€‚Node.jsã€ç€è¦½å™¨éƒ½æ²’æœ‰å•é¡Œã€‚

### Q2: å®Œå…¨ä¸­æ–‡åŒ–æœƒå½±éŸ¿åœ‹éš›åŒ–å—ï¼Ÿ
**A**: æœ¬å°ˆæ¡ˆç‚ºå…§éƒ¨ç³»çµ±ï¼Œå®Œå…¨ä¸­æ–‡åŒ–å¯æå‡åœ˜éšŠå¯è®€æ€§ã€‚è‹¥éœ€åœ‹éš›åŒ–ï¼Œå»ºè­°ä½¿ç”¨ i18n æ–¹æ¡ˆã€‚

### Q3: å¦‚ä½•è™•ç†ç¬¬ä¸‰æ–¹å¥—ä»¶çš„è‹±æ–‡å‘½åï¼Ÿ
**A**: ä¿æŒç¬¬ä¸‰æ–¹å¥—ä»¶åŸæœ‰å‘½åï¼Œåªåœ¨æ¥­å‹™é‚è¼¯å±¤é¢ä¸­æ–‡åŒ–ã€‚ä¾‹å¦‚ï¼š
```javascript
import express from 'express'; // ä¿æŒåŸæ¨£
const æ‡‰ç”¨ç¨‹å¼ = express();    // æ¥­å‹™å±¤ä¸­æ–‡åŒ–
```

### Q4: Git commit message è¦ç”¨ä¸­æ–‡å—ï¼Ÿ
**A**: å»ºè­°ä½¿ç”¨è‹±æ–‡ conventionï¼ˆfeatã€fixã€docs ç­‰ï¼‰+ ä¸­æ–‡æè¿°ï¼š
```bash
git commit -m "feat: æ–°å¢æ”¯ä»˜ç®¡ç†å™¨æ¨¡çµ„"
git commit -m "fix: ä¿®æ­£è¨‚å–®é‡è¤‡å»ºç«‹å•é¡Œ"
```

### Q5: é‡åˆ°å•é¡Œæ€éº¼è¾¦ï¼Ÿ
**A**:
1. å…ˆå›é€€åˆ°ä¸Šä¸€å€‹ commit
2. æª¢æŸ¥ console éŒ¯èª¤è¨Šæ¯
3. ä½¿ç”¨ `console.log` é™¤éŒ¯
4. åƒè€ƒæœ¬æ–‡ä»¶çš„ç¯„ä¾‹ç¨‹å¼ç¢¼
5. å‘åœ˜éšŠ Senior å·¥ç¨‹å¸«è«‹æ•™

---

## ğŸ‰ çµèª

é€™ä»½é‡æ§‹è¦åŠƒæ¶µè“‹äº†ï¼š
1. **æ–‡æª”ç²¾ç°¡** - åªä¿ç•™å¿…è¦æ–‡ä»¶
2. **ç¨‹å¼ç¢¼æ¨¡çµ„åŒ–** - æå‡å¯ç¶­è­·æ€§
3. **ç¹é«”ä¸­æ–‡åŒ–** - æå‡å¯è®€æ€§
4. **å“è³ªæå‡** - çµ±ä¸€è¦ç¯„ã€æ–°å¢è¨»é‡‹

é ä¼°å®Œæˆæ™‚é–“ï¼š**3-4 é€±**ï¼ˆæ¯å¤© 2-4 å°æ™‚ï¼‰

è«‹æŒ‰ç…§é †åºåŸ·è¡Œï¼Œæ¯å®Œæˆä¸€å€‹ Task å°±æ¸¬è©¦ï¼Œç¢ºä¿åŠŸèƒ½æ­£å¸¸ã€‚

**é‡æ§‹å®Œæˆå¾Œï¼Œä½ å°‡æ“æœ‰ä¸€å€‹çµæ§‹æ¸…æ™°ã€æ˜“æ–¼ç¶­è­·ã€å®Œå…¨ä¸­æ–‡åŒ–çš„é‡‘æµç³»çµ±ï¼**

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-12-01
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ
**ç‰ˆæœ¬**ï¼šv1.0
